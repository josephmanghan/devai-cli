<story-context id="dev/sprint-artifacts/1-2-configure-build-tooling-tsup.context.xml" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>2</storyId>
    <title>Configure Build Tooling (tsup)</title>
    <status>drafted</status>
    <generatedAt>2025-11-28</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>dev/sprint-artifacts/1-2-configure-build-tooling-tsup.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>fast ESM bundling with tsup</iWant>
    <soThat>the CLI builds quickly and outputs optimized ESM bundles</soThat>
    <tasks>Install tsup dependency, Configure build output settings, Configure entry point, Update package.json build script</tasks>
  </story>

  <acceptanceCriteria>1. tsup installed and configured in tsup.config.ts
2. Build outputs to `dist/` directory with ESM format
3. Entry point configured for CLI (src/index.ts)
4. Source maps enabled for debugging
5. Build script produces executable bundle</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>dev/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Project Setup</title>
        <section>APIs and Interfaces - Build Tooling Interface</section>
        <snippet>Build Tooling Interface (Story 1.2): tsup.config.ts with ESM format, minification enabled, target ES2022, outDir: 'dist'</snippet>
      </doc>
      <doc>
        <path>dev/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Project Setup</title>
        <section>Data Models and Contracts - tsup.config.ts Contract</section>
        <snippet>tsup.config.ts configuration: entry: ['src/index.ts'], format: ['esm'], target: 'es2022', outDir: 'dist', sourcemap: true, minify: true</snippet>
      </doc>
      <doc>
        <path>dev/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Project Setup</title>
        <section>Non-Functional Requirements - Performance</section>
        <snippet>Build Performance: `npm run build` must complete in &lt;5 seconds (tsup is optimized for speed)</snippet>
      </doc>
      <doc>
        <path>dev/architecture.md</path>
        <title>ollatool - Architecture Document</title>
        <section>Decision Summary</section>
        <snippet>Build Tool: tsup (Latest) - Fast ESM bundling with minimal config, built for TypeScript ESM projects</snippet>
      </doc>
      <doc>
        <path>dev/styleguides/nodejs-cli-setup-patterns.md</path>
        <title>Node.js CLI Setup Patterns</title>
        <section>Build Tooling</section>
        <snippet>Modern TypeScript CLI projects use tsup for fast ESM bundling with source maps and minification</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>package.json</path>
        <kind>config</kind>
        <symbol>build script</symbol>
        <lines>entire file</lines>
        <reason>Contains the build script placeholder that needs to be implemented with tsup configuration</reason>
      </artifact>
      <artifact>
        <path>tsconfig.json</path>
        <kind>config</kind>
        <symbol>compiler options</symbol>
        <lines>entire file</lines>
        <reason>TypeScript configuration that tsup will use for compilation - target ES2022, NodeNext module resolution</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="tsup" version="latest" purpose="fast ESM bundler for TypeScript"></package>
        <package name="typescript" version="^5.9.3" purpose="TypeScript compiler and language support"></package>
        <package name="@types/node" version="^24.10.1" purpose="Node.js type definitions"></package>
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>
      <name>ADR-003 (Build System)</name>
      <description>tsup for fast ESM bundling with source maps and minification</description>
      <source>dev/architecture.md#Decision-Summary</source>
    </constraint>
    <constraint>
      <name>ESM Format Required</name>
      <description>Must output ESM format only, no CommonJS</description>
      <source>dev/sprint-artifacts/tech-spec-epic-1.md#ADR-002</source>
    </constraint>
    <constraint>
      <name>Build Target</name>
      <description>Target ES2022 for Node.js 20+ compatibility</description>
      <source>dev/sprint-artifacts/tech-spec-epic-1.md#Data-Models-and-Contracts</source>
    </constraint>
    <constraint>
      <name>Performance Requirement</name>
      <description>Build must complete in &lt;5 seconds</description>
      <source>dev/sprint-artifacts/tech-spec-epic-1.md#Non-Functional-Requirements</source>
    </constraint>
    <constraint>
      <name>Clean Code Standards</name>
      <description>All code must follow dev/styleguides/clean-code.md standards</description>
      <source>dev/sprint-artifacts/1-1-initialize-typescript-project-with-esm.md#Learnings-from-Previous-Story</source>
    </constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>tsup.config.ts</name>
      <kind>configuration file</kind>
      <signature>export default defineConfig({
  entry: ['src/index.ts'],
  format: ['esm'],
  target: 'es2022',
  outDir: 'dist',
  sourcemap: true,
  minify: true,
  clean: true,
  shims: true,
});</signature>
      <path>tsup.config.ts</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Follow Epic 0 testing strategy: co-located `*.test.ts` files, Vitest framework, smoke tests for build validation. No business logic testing needed for this infrastructure story - validation done through command-line verification.</standards>
    <locations>
      <location pattern="*.test.ts" description="Co-located test files adjacent to source files"></location>
      <location pattern="dev/sprint-artifacts/" description="Test infrastructure and configuration from Epic 0"></location>
    </locations>
    <ideas>
      <idea ac="1">Verify `npm run build` creates dist/index.js without errors</idea>
      <idea ac="2">Test output file is valid ESM format and can be imported</idea>
      <idea ac="3">Verify entry point matches expected src/index.ts path</idea>
      <idea ac="4">Test source maps are generated and working</idea>
      <idea ac="5">Manual test: `npm run build` completes in &lt;5 seconds</idea>
    </ideas>
  </tests>
</story-context>