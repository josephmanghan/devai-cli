<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>5</epicId>
    <storyId>1</storyId>
    <title>implement-ui-components</title>
    <status>drafted</status>
    <generatedAt>2025-12-02</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>dev/sprint-artifacts/5-1-implement-ui-components.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a developer using ollatool</asA>
    <iWant>interactive terminal prompts that guide me through commit message generation</iWant>
    <soThat>I can efficiently review and approve commit messages without leaving the terminal</soThat>
    <tasks>- [ ] Task 1: Create Core Commit Types (AC: 4)
  - [ ] Subtask 1.1: Create `src/core/types/commit.types.ts`.
  - [ ] Subtask 1.2: Define and export `CommitType` and `CommitAction` enums from core.
- [ ] Task 2: Create Commit UI Directory Structure (AC: 5)
  - [ ] Subtask 2.1: Create `src/ui/commit/components/` directory.
  - [ ] Subtask 2.2: Create component directories: `type-selector/`, `message-preview/`, `action-selector/`.
- [ ] Task 3: Implement TypeSelector component (AC: 1, 6, 7, 8)
  - [ ] Subtask 3.1: Create `src/ui/commit/components/type-selector/type-selector.ts`.
  - [ ] Subtask 3.2: Implement `selectCommitType` using `@clack/prompts.select`.
  - [ ] Subtask 3.3: Map all 11 types to options.
  - [ ] Subtask 3.4: Add `isCancel` check immediately after await.
  - [ ] Subtask 3.5: Create `type-selector.demo.ts` following `src/ui/setup/console-setup-renderer.demo.ts` pattern.
  - [ ] Subtask 3.6: Create `type-selector.test.ts` following `src/ui/setup/console-setup-renderer.test.ts` pattern.
  - [ ] Subtask 3.7: Create `index.ts` barrel export.
- [ ] Task 4: Implement MessagePreview component (AC: 2, 6, 8)
  - [ ] Subtask 4.1: Create `src/ui/commit/components/message-preview/message-preview.ts`.
  - [ ] Subtask 4.2: Implement `previewMessage` using `@clack/prompts.note` (or `console.log` with `chalk` if note is insufficient).
  - [ ] Subtask 4.3: Create `message-preview.demo.ts` following `src/ui/setup/console-setup-renderer.demo.ts` pattern.
  - [ ] Subtask 4.4: Create `message-preview.test.ts` following `src/ui/setup/console-setup-renderer.test.ts` pattern.
  - [ ] Subtask 4.5: Create `index.ts` barrel export.
- [ ] Task 5: Implement ActionSelector component (AC: 3, 6, 7, 8)
  - [ ] Subtask 5.1: Create `src/ui/commit/components/action-selector/action-selector.ts`.
  - [ ] Subtask 5.2: Implement `selectCommitAction` using `@clack/prompts.select`.
  - [ ] Subtask 5.3: Add `isCancel` check immediately after await.
  - [ ] Subtask 5.4: Create `action-selector.demo.ts` following `src/ui/setup/console-setup-renderer.demo.ts` pattern.
  - [ ] Subtask 5.5: Create `action-selector.test.ts` following `src/ui/setup/console-setup-renderer.test.ts` pattern.
  - [ ] Subtask 5.6: Create `index.ts` barrel export.
- [ ] Task 6: Create Commit UI Barrel Exports (AC: 4, 5)
  - [ ] Subtask 6.1: Create `src/ui/commit/index.ts` exporting all components.
- [ ] Task 7: Integration Testing (AC: 8)
  - [ ] Subtask 7.1: Verify all demos run with `npm run test:demo`.
  - [ ] Subtask 7.2: Verify all unit tests run with standard test runner.
  - [ ] Subtask 7.3: Test component imports through barrel exports.</tasks>
  </story>

  <acceptanceCriteria>1. **TypeSelector Component** - Presents numbered list of Conventional Commits types (feat, fix, docs, etc.) with arrow/number selection support [FR13].
2. **MessagePreview Component** - Displays generated commit messages in terminal for review with proper formatting [FR25].
3. **ActionSelector Component** - Provides [A]pprove, [E]dit, [R]egenerate, [C]ancel options with keyboard shortcuts [FR30-FR32].
4. **Core Types** - All Enums (`CommitType`, `CommitAction`) are exported from `src/core/types/commit.types.ts`, not hidden inside UI components.
5. **Domain Structure** - Each component lives in its own directory under `src/ui/commit/components/` with demo and test files.
6. **Stateless Design** - Components are pure functions using `@clack/prompts` 0.11.0.
7. **Cancel Handling** - All prompts handle `isCancel` (Ctrl+C) gracefully by exiting the process.
8. **Demo Testing** - Each component has a `.demo.ts` file that runs with existing `npm run test:demo`.</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>dev/prd.md</path>
        <title>Product Requirements Document</title>
        <section>Interactive Workflow Requirements (FR13, FR25, FR30-FR32)</section>
        <snippet>FR13: Users shall select commit type via interactive menu (numbered list with arrow/number support). FR25: Generated commit messages display with proper formatting in terminal. FR30: Users can approve generated message with keyboard shortcut. FR31: Users can edit generated messages directly. FR32: Users can regenerate messages.</snippet>
      </doc>
      <doc>
        <path>dev/architecture.md</path>
        <title>System Architecture</title>
        <section>Hexagonal Architecture - UI Layer</section>
        <snippet>UI components form the outer layer, providing terminal-based user interactions. Components must be pure functions using @clack/prompts 0.11.0, implementing proper cancel handling with isCancel checks and process.exit(0). Follow domain-driven directory structure under src/ui/.</snippet>
      </doc>
      <doc>
        <path>dev/ux-design.md</path>
        <title>UX Design Specification</title>
        <section>Interactive Design Patterns</section>
        <snippet>Use @clack/prompts for interactive elements with consistent keyboard shortcuts: [A]pprove, [E]dit, [R]egenerate, [C]ancel. All prompts must handle Ctrl+C gracefully. Performance target: sub-1s response time. Accessibility compliance required.</snippet>
      </doc>
      <doc>
        <path>dev/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Epic 5: Interactive Workflow & CLI</section>
        <snippet>Epic 5 focuses on terminal UI components for commit workflow. Story 5.1 specifically implements TypeSelector, MessagePreview, and ActionSelector components using established patterns from console-setup-renderer.</snippet>
      </doc>
    </docs>
    <code>
      <code>
        <path>src/ui/setup/console-setup-renderer.ts</path>
        <kind>component</kind>
        <symbol>ConsoleSetupRenderer</symbol>
        <lines>1-50</lines>
        <reason>Pattern to follow for UI component implementation with proper class structure and method signatures</reason>
      </code>
      <code>
        <path>src/ui/setup/console-setup-renderer.demo.ts</path>
        <kind>demo</kind>
        <symbol>runDemo</symbol>
        <lines>1-30</lines>
        <reason>Pattern to replicate for component demo files with scenario testing and sleep utilities</reason>
      </code>
      <code>
        <path>src/ui/setup/console-setup-renderer.test.ts</path>
        <kind>test</kind>
        <symbol>ConsoleSetupRenderer</symbol>
        <lines>1-20</lines>
        <reason>Pattern for unit testing with vitest, mocking, and beforeEach setup</reason>
      </code>
      <code>
        <path>src/core/types/index.ts</path>
        <kind>types</kind>
        <symbol>exports</symbol>
        <lines>1-10</lines>
        <reason>Pattern for barrel exports and type organization in core types</reason>
      </code>
      <code>
        <path>src/core/types/ui.types.ts</path>
        <kind>types</kind>
        <symbol>ProgressUpdate</symbol>
        <lines>1-15</lines>
        <reason>Existing UI types pattern for interface structure and readonly properties</reason>
      </code>
      <code>
        <path>src/core/types/git-types.ts</path>
        <kind>types</kind>
        <symbol>GenerateCommitInput, GenerateCommitOutput</symbol>
        <lines>20-40</lines>
        <reason>Existing commit-related types to understand data structures and naming conventions</reason>
      </code>
    </code>
    <dependencies>
      <dependencies>
        <ecosystem>Node.js</ecosystem>
        <package>ora</package>
        <version>^9.0.0</version>
        <purpose>Spinners and progress indicators</purpose>
      </dependencies>
      <dependencies>
        <ecosystem>Node.js</ecosystem>
        <package>commander</package>
        <version>14.0.2</version>
        <purpose>CLI framework</purpose>
      </dependencies>
      <dependencies>
        <ecosystem>Node.js</ecosystem>
        <package>vitest</package>
        <version>^4.0.14</version>
        <purpose>Test runner for unit tests and demos</purpose>
      </dependencies>
      <dependencies>
        <ecosystem>Node.js</ecosystem>
        <package>@clack/prompts</package>
        <version>0.11.0</version>
        <purpose>Interactive prompts (TO BE INSTALLED)</purpose>
      </dependencies>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Components must be pure functions using @clack/prompts 0.11.0</constraint>
    <constraint>All prompts must implement isCancel handling with process.exit(0)</constraint>
    <constraint>Follow domain-driven directory structure: src/ui/commit/components/[component]/</constraint>
    <constraint>Each component requires .ts, .demo.ts, .test.ts, and index.ts files</constraint>
    <constraint>Core types must be exported from src/core/types/commit.types.ts, not hidden in components</constraint>
    <constraint>Components must be stateless with no business logic</constraint>
    <constraint>Follow established patterns from console-setup-renderer for testing and demos</constraint>
    <constraint>Use project-relative paths only, strip /Users/josephm@backbase.com/Documents/Personal/Agentic notes/Projects/Ollama-CLI-application/ prefix</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>CommitType</name>
      <kind>enum</kind>
      <signature>export type CommitType = 'feat' | 'fix' | 'docs' | 'style' | 'refactor' | 'perf' | 'test' | 'build' | 'ci' | 'chore' | 'revert'</signature>
      <path>src/core/types/commit.types.ts</path>
    </interface>
    <interface>
      <name>CommitAction</name>
      <kind>enum</kind>
      <signature>export enum CommitAction { APPROVE, EDIT, REGENERATE, CANCEL }</signature>
      <path>src/core/types/commit.types.ts</path>
    </interface>
    <interface>
      <name>selectCommitType</name>
      <kind>function</kind>
      <signature>export async function selectCommitType(): Promise<CommitType></signature>
      <path>src/ui/commit/components/type-selector/type-selector.ts</path>
    </interface>
    <interface>
      <name>previewMessage</name>
      <kind>function</kind>
      <signature>export async function previewMessage(message: string): Promise<void></signature>
      <path>src/ui/commit/components/message-preview/message-preview.ts</path>
    </interface>
    <interface>
      <name>selectCommitAction</name>
      <kind>function</kind>
      <signature>export async function selectCommitAction(): Promise<CommitAction></signature>
      <path>src/ui/commit/components/action-selector/action-selector.ts</path>
    </interface>
  </interfaces>
  <tests>
    <standards>Use vitest for unit testing with vi.mock for external dependencies. Follow console-setup-renderer.test.ts pattern with beforeEach setup and proper cleanup. Tests must verify component functionality, cancel handling, and proper error flow. Each component requires both .demo.ts (manual verification) and .test.ts (automated testing) files following established patterns.</standards>
    <locations>src/ui/commit/components/[component]/*.test.ts for unit tests, src/ui/commit/components/[component]/*.demo.ts for manual verification. All demos run via npm run test:demo, unit tests via standard test runner. Follow src/ui/setup/console-setup-renderer.* pattern for file organization.</locations>
    <ideas>
      <test-idea ac="1">Test TypeSelector with all 11 commit types, verify arrow/number selection, and test cancel handling</test-idea>
      <test-idea ac="2">Test MessagePreview displays formatted commit messages, handles empty/null messages gracefully</test-idea>
      <test-idea ac="3">Test ActionSelector presents [A]pprove, [E]dit, [R]egenerate, [C]ancel with proper keyboard shortcuts</test-idea>
      <test-idea ac="7">Test cancel handling (Ctrl+C) in all components with isCancel detection and process.exit(0)</test-idea>
      <test-idea ac="8">Integration test: Verify npm run test:demo runs all component demos successfully</test-idea>
    </ideas>
  </tests>
</story-context>